{% extends "base.html" %}

{% block title %}{{ application.company }} - {{ application.role }} - Job Tracker{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-6">
        <a href="{{ url_for('applications.index') }}" class="text-gray-600 hover:text-gray-800">
            <i class="fas fa-arrow-left mr-2"></i>Back to Applications
        </a>
    </div>

    <!-- Application Header -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <h1 class="text-2xl font-bold text-gray-900">{{ application.company }}</h1>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                        {% if application.status_color == 'green' %}bg-green-100 text-green-800
                        {% elif application.status_color == 'blue' %}bg-blue-100 text-blue-800
                        {% elif application.status_color == 'indigo' %}bg-indigo-100 text-indigo-800
                        {% elif application.status_color == 'purple' %}bg-purple-100 text-purple-800
                        {% elif application.status_color == 'yellow' %}bg-yellow-100 text-yellow-800
                        {% elif application.status_color == 'red' %}bg-red-100 text-red-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ application.status_display }}
                    </span>
                </div>
                <p class="text-xl text-gray-600 mb-4">{{ application.role }}</p>
                
                <div class="flex flex-wrap gap-4 text-sm text-gray-500">
                    {% if application.location %}
                    <span><i class="fas fa-map-marker-alt mr-1"></i>{{ application.location }}</span>
                    {% endif %}
                    {% if application.salary_range %}
                    <span><i class="fas fa-dollar-sign mr-1"></i>{{ application.salary_range }}</span>
                    {% endif %}
                    {% if application.date_applied %}
                    <span><i class="fas fa-calendar mr-1"></i>Applied {{ application.date_applied.strftime('%B %d, %Y') }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="mt-4 md:mt-0 flex gap-2">
                {% if application.url %}
                <a href="{{ application.url }}" target="_blank" 
                   class="inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition">
                    <i class="fas fa-external-link-alt mr-2"></i>Job Post
                </a>
                {% endif %}
                <a href="{{ url_for('applications.edit', id=application.id) }}" 
                   class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition">
                    <i class="fas fa-edit mr-2"></i>Edit
                </a>
            </div>
        </div>

        <!-- Status Quick Update -->
        <div class="mt-6 pt-6 border-t">
            <form method="POST" action="{{ url_for('applications.update_status', id=application.id) }}" class="flex items-center gap-4">
                <label class="text-sm font-medium text-gray-700">Quick Status Update:</label>
                <select name="status" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    {% for value, label in status_choices %}
                    <option value="{{ value }}" {% if application.status == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium rounded-lg transition">
                    Update
                </button>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Notes -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-sticky-note mr-2 text-gray-400"></i>Notes
                </h2>
                {% if application.notes %}
                <p class="text-gray-700 whitespace-pre-wrap">{{ application.notes }}</p>
                {% else %}
                <p class="text-gray-500 italic">No notes added yet.</p>
                {% endif %}
            </div>

            <!-- Interviews -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-calendar-check mr-2 text-gray-400"></i>Interviews
                    </h2>
                    <a href="{{ url_for('interviews.new', application_id=application.id) }}" 
                       class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                        <i class="fas fa-plus mr-1"></i>Add Interview
                    </a>
                </div>
                
                {% set interviews = application.interviews.order_by('scheduled_at').all() %}
                {% if interviews %}
                <div class="space-y-3">
                    {% for interview in interviews %}
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900">{{ interview.type_display }}</p>
                            <p class="text-sm text-gray-500">
                                {{ interview.scheduled_at.strftime('%b %d, %Y at %I:%M %p') }}
                                {% if interview.interviewer %} with {{ interview.interviewer }}{% endif %}
                            </p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium
                                {% if interview.outcome == 'passed' %}bg-green-100 text-green-800
                                {% elif interview.outcome == 'failed' %}bg-red-100 text-red-800
                                {% elif interview.outcome == 'cancelled' %}bg-gray-100 text-gray-800
                                {% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ interview.outcome_display }}
                            </span>
                            <a href="{{ url_for('interviews.edit', id=interview.id) }}" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 italic">No interviews scheduled yet.</p>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Documents -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-file-alt mr-2 text-gray-400"></i>Documents
                    </h2>
                    <a href="{{ url_for('documents.new', application_id=application.id) }}" 
                       class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                        <i class="fas fa-plus"></i>
                    </a>
                </div>
                
                {% set documents = application.documents.all() %}
                {% if documents %}
                <div class="space-y-2">
                    {% for doc in documents %}
                    <div class="flex items-center justify-between py-2">
                        <div class="flex items-center">
                            <i class="fas fa-file-pdf text-red-400 mr-2"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-900">{{ doc.filename }}</p>
                                <p class="text-xs text-gray-500">{{ doc.type_display }}</p>
                            </div>
                        </div>
                        {% if doc.url %}
                        <a href="{{ doc.url }}" target="_blank" class="text-primary-600 hover:text-primary-700">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-sm italic">No documents attached.</p>
                {% endif %}
            </div>

            <!-- Reminders -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-bell mr-2 text-gray-400"></i>Reminders
                    </h2>
                    <a href="{{ url_for('reminders.new', application_id=application.id) }}" 
                       class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                        <i class="fas fa-plus"></i>
                    </a>
                </div>
                
                {% set reminders = application.reminders.filter_by(completed=False).order_by('remind_on').all() %}
                {% if reminders %}
                <div class="space-y-2">
                    {% for reminder in reminders %}
                    <div class="flex items-start justify-between py-2 {% if reminder.is_due %}bg-yellow-50 -mx-2 px-2 rounded{% endif %}">
                        <div>
                            <p class="text-sm text-gray-900">{{ reminder.message }}</p>
                            <p class="text-xs {% if reminder.is_overdue %}text-red-600{% else %}text-gray-500{% endif %}">
                                {{ reminder.remind_on.strftime('%b %d, %Y') }}
                                {% if reminder.is_overdue %}(overdue){% endif %}
                            </p>
                        </div>
                        <form method="POST" action="{{ url_for('reminders.complete', id=reminder.id) }}">
                            <button type="submit" class="text-gray-400 hover:text-green-600" title="Mark complete">
                                <i class="fas fa-check-circle"></i>
                            </button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-sm italic">No active reminders.</p>
                {% endif %}
            </div>

            <!-- Danger Zone -->
            <div class="bg-white rounded-lg shadow-sm border border-red-200 p-6">
                <h2 class="text-lg font-semibold text-red-600 mb-4">Danger Zone</h2>
                <form method="POST" action="{{ url_for('applications.delete', id=application.id) }}" 
                      onsubmit="return confirm('Are you sure you want to delete this application? This cannot be undone.');">
                    <button type="submit" class="w-full px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 font-medium rounded-lg transition">
                        <i class="fas fa-trash mr-2"></i>Delete Application
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

